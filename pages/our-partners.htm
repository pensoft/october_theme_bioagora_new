url = "/our-partners"
layout = "default"
title = "Our Partners"

[siteSearchInclude]

[jumbotron]
jumbotron = "partners"
background = "transperant"
templates = "template3"
description_limit = 0

[menu tabs_menu]
start = "id-2"
activeNode = 0
listItemClasses = "item"
primaryClasses = "nav nav-pills"
secondaryClasses = "dropdown-menu"
numberOfLevels = 2

==
<?php
use Pensoft\Partners\Models\Partners;
use Rainlab\User\Models\User as Profiles;

use Pensoft\CardProfiles\Models\Profiles as Prof;


function onStart(){
	$this['partners'] =  Partners::get();

    $this['partner_members'] = new class {
        public function getProfiles($partnerId) {
            return Profiles::where('is_visible', 1)->where('partner_id', $partnerId)->orderBy('name')->get();
        }
    };


    $this['insider_members'] = new class {
        public function getIM($id) {
            return Prof::where('partner_id', $id)->where('category_id', 1)->get();
        }
    };


}


function onPartners(){
    if(post('code')){
        $this['partners'] =  Partners::whereRaw('country_code ILIKE \'%'.post('code').'%\'')->where('type', 1)->get();
    }

    $this['partner_members'] = new class {
        public function getProfiles($partnerId) {
            return Prof::where('is_visible', 1)->where('partner_id', $partnerId)->get();
        }
    };

    $this['insider_members'] = new class {
        public function getIM($id) {
            return Prof::where('partner_id', $id)->where('category_id', 1)->get();
        }
    };

}
?>
==
{% component 'siteSearchInclude' %}

<main id="main-content" role="main" aria-labelledby="partners-page-title">
    <!-- Page Title (screen reader only) -->
    <h1 id="partners-page-title" class="sr-only">Our Partners</h1>

    <div class="container">
        <div class="category-tabs">
            {% component 'tabs_menu' %}
        </div>
    </div>

    <!-- Jumbotron Section -->
    <section role="banner"
             class="container800"
             aria-labelledby="featured-content-heading"
             aria-describedby="featured-content-description">
        <h2 id="featured-content-heading" class="sr-only">Featured Content</h2>
        <div id="featured-content-description" class="sr-only">
            Introduction and overview of our partner organizations and their locations
        </div>
        {% component 'jumbotron' %}
    </section>

    <!-- Partners Map Section -->
    <section id="partners-map"
             class="container-fluid page-bg map-section"
             role="region"
             aria-labelledby="partners-map-heading"
             aria-describedby="partners-map-description">

        <div class="container">
            <header>
                <h2 id="partners-map-heading" class="sr-only">Partners Location Map</h2>
                <div id="partners-map-description" class="sr-only">
                    Interactive map showing the geographical locations of our partner organizations across different countries
                </div>
            </header>

            <!-- Tooltip for Map Interactions -->
            <div class="tooltiptext"
                 id="tooltip"
                 role="tooltip"
                 aria-hidden="true"
                 aria-live="polite">
                Bulgaria
            </div>

            <section class="container tabs_container partners" role="region" aria-labelledby="partner-heading">
                <h1 id="partner-heading" class="sr-only">Partners</h1>
                <div class="tabs" role="tablist" aria-label="Partners view options">

                    <a class="" href="#mapView" role="tab" aria-selected="false" aria-controls="mapView" id="tab-map">Map View</a>

                    <a class="" href="#listView" role="tab" aria-selected="true" aria-controls="listView" id="tab-list">List View</a>

                </div>
            </section>
            <div class="row" id="mapView" role="tabpanel" aria-labelledby="tab-map">
                <!-- Map Component -->
                <div role="img"
                     aria-labelledby="map-heading"
                     aria-describedby="map-instructions"
                    style="width: 100%"
                >
                    <h3 id="map-heading" class="sr-only">Interactive Partners Map</h3>
                    <div id="map-instructions" class="sr-only">
                        Use keyboard navigation to explore partner locations. Map shows {{ partners|length }} partner organizations.
                    </div>
                    {% partial 'map' %}
                </div>


                <!-- Partners Cards Section -->
                <section id="partners-cards"
                         class="container-fluid partners-cards-section"
                         role="region"
                         aria-labelledby="partners-cards-heading"
                         aria-describedby="partners-cards-description">

                    <div class="container">
                        <header>
                            <h2 id="partners-cards-heading" class="sr-only">Partner Organizations</h2>
                            <div id="partners-cards-description" class="sr-only">
                                Interactive cards showing {{ partners|length }} partner organizations. Each card can be activated to reveal detailed information, contact links, and partner websites.
                            </div>
                        </header>

                        <div id="mycomponentpartners"
                             class="row partners-grid"
                             role="list"
                             aria-label="List of {{ partners|length }} partner organizations">

                        </div>

                        <!-- Partners Summary -->
                        <footer class="partners-cards-summary sr-only" role="contentinfo">
                            End of partner organizations section. {{ partners|length }} partner organizations from various countries, each with contact information and official websites.
                        </footer>
                    </div>
                </section>

            </div>
            <div class="row" id="listView" role="tabpanel" aria-labelledby="tab-list">
                {% for k, partner in partners %}
                <div class="col-md-4 col-xs-12">
                    <div class="flip-card">
                        <div class="flip-card-inner">
                            <div class="flip-card-front">
                                <div class="flip-card-content">
                                    {% if partner.cover %}
                                    <a href="{{partner.instituion_url}}" aria-label="Open the {{ partner.instituion }} website (opens in new tab)" target="_blank"><img alt="{{ partner.instituion }}" src="{{partner.cover.getThumb(auto,42, { mode : 'crop' } )}}"></a>
                                    {% endif %}
                                    <div class="partner_title">
                                        <h3>{{ partner.instituion }}</h3>
                                    </div>
                                    <div class="overlay">
                                        <div class="partner_title" id="partner-title-{{k}}">
                                            <h3>{{ partner.instituion }}</h3>
                                        </div>
                                        <div class="read_more_container">
                                            <a data-toggle="modal"
                                               href="#partner{{k}}"
                                               class="read_more"
                                               aria-label="Read more about {{partner.instituion}}"
                                               role="button">Read more</a>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="control-popup modal fade"
                     id="partner{{k}}"
                     tabindex="-1"
                     role="dialog"
                     aria-labelledby="modal-title-{{k}}"
                     aria-describedby="modal-content-{{k}}"
                     aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <button type="button"
                                    class="close"
                                    data-dismiss="modal"
                                    aria-label="Close partner information dialog">
                                &times;
                            </button>


                            <div class="row">
                                <div class="col-md-5 col-xs-12 logo_and_btn">
                                    <div class="partner-logo-container">
                                        {% if partner.cover %}
                                        <img class="partner-logo"
                                             src="{{partner.cover.getThumb(auto, 100, {'mode': 'crop'})}}"
                                             alt="Logo for {{ partner.instituion }} partner"
                                             role="img">
                                        {% endif %}
                                    </div>

                                    <div class="partner-website-container">
                                        {% if partner.instituion_url %}
                                        <a href="{{partner.instituion_url}}"
                                           class="partner_website"
                                           target="_blank"
                                           rel="noopener noreferrer"
                                           aria-describedby="website-{{partner.id}}-desc">
                                            Visit website
                                            <span class="sr-only">Visit {{ partner.instituion }} website (opens in new window)</span>
                                        </a>
                                        <span id="website-topical-{{partner.id}}-desc" class="sr-only">
                                            Opens the official website for {{ partner.instituion }} partner in a new window
                                        </span>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-7 col-xs-12 overflow_scroll">
                                    <!-- partner Description -->
                                    <section class="partner-description"
                                             aria-labelledby="description-heading-{{partner.id}}">
                                        <h3 id="description-topical-heading-{{partner.id}}" class="sr-only">
                                            Partner Description
                                        </h3>
                                        <div class="description-content" role="document">
                                            <div class="partner_info">
                                                <div class="partner_description" style="">
                                                    <div class="sr-only">Description for {{ partner.instituion }}:</div>
                                                    {{partner.content|raw}}
                                                </div>
                                                <p><a class="read-more dorsal">Read more</a></p>
                                            </div>
                                            <div class="partner_detailed_info">
                                                {% if insider_members.getIM(partner.id).count > 0 %}
                                                <section role="region" aria-labelledby="members-heading-{{k}}">
                                                    <h3 id="members-heading-{{k}}">Our Team</h3>
                                                    <div class="partners_list_content">
                                                        {% for profile in insider_members.getIM(partner.id) %}
                                                        <article class="contact_info row" role="article" aria-labelledby="member-name-{{k}}-{{loop.index}}">
                                                            <div class="col-md-3 col-xs-12 coordinator_image">
                                                                {% if profile.avatar %}
                                                                <img alt="Photo of {{ profile.names }}" src="{{profile.avatar.getThumb(86,78, { mode : 'crop' } )}}">
                                                                {% else %}
                                                                <img alt="Default avatar for {{ profile.names }}" src="{{ 'avatar.svg'|media }}" width="82" height="67" class="no-image">
                                                                {% endif %}
                                                            </div>
                                                            <div class="col-md-6 col-xs-12 coordinator_info">
                                                                <div class="">
                                                                    <h4 id="member-name-{{k}}-{{loop.index}}">{{ profile.names }}</h4>
                                                                    {% if profile.email %}
                                                                    <div class="position">
                                                                        <a href="mailto:{{ profile.email }}"
                                                                           target="_blank"
                                                                           aria-label="Send email to {{ profile.names }}">{{ profile.email }}</a>
                                                                    </div>
                                                                    {% endif %}
                                                                    {% if profile.position %} <div class="position">{{ profile.position }}</div>{% endif %}
                                                                </div>
                                                            </div>
                                                            <div class="col-md-3 col-xs-12">
                                                                <p class="read-more"
                                                                   onclick="expandBiography(this);"
                                                                   aria-expanded="false"
                                                                   aria-controls="bio-{{k}}-{{loop.index}}"
                                                                   aria-label="Read biography of {{ profile.names }}">Biography</p>
                                                            </div>
                                                            <div class="col-md-12">
                                                                <div class="body"
                                                                     id="bio-{{k}}-{{loop.index}}"
                                                                     style="display: none;"
                                                                     role="region"
                                                                     aria-labelledby="member-name-{{k}}-{{loop.index}}">{{ profile.content|raw }}</div>
                                                            </div>
                                                        </article>
                                                        {% endfor %}
                                                    </div>
                                                </section>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </section>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                {% endfor %}
            </div>

        </div>


    </section>


</main>

<!--&lt;!&ndash; Live Region for Card Flip Announcements &ndash;&gt;-->
<!--<div id="partners-live-region"-->
<!--     aria-live="polite"-->
<!--     aria-atomic="true"-->
<!--     class="sr-only"-->
<!--     role="status">-->
<!--</div>-->

