url = "/events/:slug?|[a-zA-Z\-0-9]"
layout = "default"
title = "Events"
is_hidden = 0
robot_index = "index"
robot_follow = "follow"

[calendar]
default = "true"
limit = "null"
category = "null"
language = "en"
redirect_to_detailed_page = "false"
default_view = "dayGridMonth"


[menu tabs_menu]
start = "id-13"
activeNode = 0
listItemClasses = "item"
primaryClasses = "nav nav-pills"
secondaryClasses = "dropdown-menu"
numberOfLevels = 2

==
<?php
use Pensoft\Calendar\Models\Entry;
use Carbon\Carbon;
use Pensoft\Articles\Models\Category;
use Pensoft\Articles\Models\Article;

function onStart(){

    if($this->param('slug')){
$this['entry'] =  Entry::select(
'*',
'title',
'place',
'description',
'url',

DB::raw("to_char(\"start\", 'DD') as start_day"),
DB::raw("to_char(\"start\", 'YYYY') as start_year"),
DB::raw("to_char(\"end\", 'DD') as end_day"),
DB::raw("to_char(\"end\", 'YYYY') as end_year"),
DB::raw("to_char(\"start\", 'month') as start_month"),
DB::raw("to_char(\"end\", 'month') as end_month"),
DB::raw("
\"end\" is not null as has_end
")


)->where('slug', $this->param('slug'))->first();

\BennoThommo\Meta\Meta::set('twitter:card', 'summary_large_image');
\BennoThommo\Meta\Meta::set('twitter:title', $this['entry']['title']);
\BennoThommo\Meta\Meta::set('twitter:description', str_limit(Html::strip($this['entry']['description']), 255));
\BennoThommo\Meta\Meta::set('og:title', $this['entry']['title']);
\BennoThommo\Meta\Meta::set('og:description', str_limit(Html::strip($this['entry']['description']), 255) );
\BennoThommo\Meta\Meta::set('og:type', 'article');
\BennoThommo\Meta\Meta::set('og:url', $this->pageUrl(''));
if($this['entry']['cover_image']){
\BennoThommo\Meta\Meta::set('twitter:image', $this['entry']['cover_image']->getThumb(600, null, ['mode' => 'auto']));


\BennoThommo\Meta\Meta::set('og:image', $this['entry']['cover_image']->getThumb(600, 314, ['mode' => 'crop']));
\BennoThommo\Meta\Meta::set('og:image:width', 600);
\BennoThommo\Meta\Meta::set('og:image:height', 314);
}

}
$this['page_url'] = $this->pageUrl('');

$this['entries'] = Entry::where('end', '>=', Carbon::now())->orderBy('start', 'asc')->paginate(20);

$this['past_entries'] = Entry::where('end', '<', Carbon::now())->orderBy('start', 'desc')->paginate(20);


$this['slug'] = $this->param('slug');

$categoryId = 1;
$this['events_articles'] = Article::news()->whereHas('categories', function ($query) use ($categoryId) {
$query->where('id', $categoryId);
})->where('published_at', '<=', 'now')
->where('published', 'true')
->orderBy('published_at', 'DESC')->get();


$this['page_url'] = $this->pageUrl('');





}
?>
==
{% if not slug %}

<main id="main-content" class="container-fluid events" role="main" aria-labelledby="events-page-title">
    <header class="container">
        <h1 id="events-page-title" class="sr-only">Events and News</h1>

            <div class="category-tabs">
                {% component 'tabs_menu' %}
            </div>

        <!-- Primary Navigation Tabs -->
        <nav id="events-navigation" class="tabs" role="navigation" aria-labelledby="primary-tabs-heading">
            <h2 id="primary-tabs-heading" class="sr-only">Events Page Navigation</h2>
            <ul class="tabs-list" role="tablist">
                <li role="presentation">
                    <a href="#events"
                       role="tab"
                       aria-selected="true"
                       aria-controls="events-panel"
                       id="events-tab"
                       tabindex="0">
                        Events
                    </a>
                </li>
                <li role="presentation">
                    <a href="#news-events"
                       role="tab"
                       aria-selected="false"
                       aria-controls="news-events-panel"
                       id="news-events-tab"
                       tabindex="-1">
                        News about events
                    </a>
                </li>
            </ul>
        </nav>
    </header>

    <div class="container events_container">
        <!-- Events Tab Panel -->
        <section class="row"
                 id="events"
                 role="tabpanel"
                 aria-labelledby="events-tab"
                 aria-describedby="events-description">
            <div id="events-description" class="sr-only">
                Browse upcoming and past events in list or calendar view
            </div>

            <!-- Sub-navigation for List/Calendar Views -->
            <nav class="subtabs_events" aria-labelledby="view-options-heading">
                <h3 id="view-options-heading" class="sr-only">View Options</h3>
                <ul class="ui-tabs-nav" role="tablist" aria-label="Event view options">
                    <li role="presentation">
                        <a href="#listView"
                           role="tab"
                           aria-selected="true"
                           aria-controls="listView-panel"
                           id="listView-tab"
                           aria-describedby="listView-desc">
                            <span class="sr-only">List View</span>
                            <span aria-hidden="true"></span>
                        </a>
                        <span id="listView-desc" class="sr-only">View events as a list</span>
                    </li>
                    <li role="presentation">
                        <a href="#calendarView"
                           role="tab"
                           aria-selected="false"
                           aria-controls="calendarView-panel"
                           id="calendarView-tab"
                           aria-describedby="calendarView-desc">
                            <span class="sr-only">Calendar View</span>
                            <span aria-hidden="true"></span>
                        </a>
                        <span id="calendarView-desc" class="sr-only">View events in calendar format</span>
                    </li>
                </ul>

                <!-- List View Panel -->
                <div id="listView"
                     class="subtabContent"
                     role="tabpanel"
                     aria-labelledby="listView-tab"
                     aria-describedby="events-list-description">

                    <div id="events-list-description" class="sr-only">
                        List of upcoming events with dates, images, and details
                    </div>

                    <!-- Upcoming Events -->
                    <section class="events_list_container" aria-labelledby="upcoming-events-heading">
                        <h3 id="upcoming-events-heading" class="sr-only">Upcoming Events</h3>

                        <div class="events-list" role="list" aria-label="Upcoming events">
                            {% for entry in entries %}
                            {% set url = entry.url ? entry.url : '/events/' ~ entry.slug %}

                            <article class="row entry_item middle-xs" role="listitem">


                                <div class="col-md-10 col-xs-12">
                                    <div class="row">
                                        <!-- Event Date -->
                                        <div class="col-md-2 col-xs-12 date_container">
                                            <time datetime="{{entry.start|date('c')}}"
                                                  aria-label="Event date">
                                                <span class="date_day" aria-label="Date and month">{{entry.start|date("j M")}}</span>
                                                <span class="date_year" aria-label="Year">{{entry.start|date("Y")}}</span>
                                            </time>
                                        </div>

                                        <!-- Event Content -->
                                        <div class="col-md-8 col-xs-12">
                                            {% if entry.cover_image %}
                                            <a href="{{'events'|page}}/{{entry.slug}}"
                                               aria-describedby="event-image-{{entry.slug}}-desc">
                                                <img src="{{entry.cover_image|crop_image|resize(174, auto, {'mode': 'crop'})}}"
                                                     alt="Cover image for {{entry.title}}"
                                                     role="img"
                                                     loading="lazy">
                                            </a>
                                            <span id="event-image-{{entry.slug}}-desc" class="sr-only">
                                        View details for {{entry.title}}
                                    </span>
                                            {% endif %}

                                            <h4 class="event-title">
                                                <a href="{{'events'|page}}/{{entry.slug}}"
                                                   aria-describedby="event-title-{{entry.slug}}-desc">
                                                    {{entry.title|raw}}
                                                </a>
                                            </h4>
                                            <span id="event-title-{{entry.slug}}-desc" class="sr-only">
                                        Event on {{entry.start|date("j M Y")}}
                                    </span>
                                        </div>

                                    </div>
                                </div>



                                <!-- Event Action -->
                                <div class="col-md-2 col-xs-12 end-md center-xs">
                                    <a href="{{'events'|page}}/{{entry.slug}}"

                                       aria-describedby="learn-more-{{entry.slug}}-desc">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" viewBox="0 0 21 21" fill="none">
                                            <path d="M0.649968 10.2409L19.8315 10.2409M19.8315 10.2409L10.2407 19.8317M19.8315 10.2409L10.2407 0.650024" stroke="#00BDA7" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    </a>
                                    <span id="learn-more-{{entry.slug}}-desc" class="sr-only">
                                        Learn more about {{entry.title}}
                                    </span>
                                </div>
                            </article>
                            {% endfor %}
                        </div>
                    </section>

                    <!-- Pagination for Upcoming Events -->
                    {% if entries.count > 20 %}
                    <nav class="pagination-container"
                         role="navigation"
                         aria-label="Upcoming events pagination">
                        <div class="row container">
                            {{ entries.fragment('listView').render|raw }}
                        </div>
                    </nav>
                    {% endif %}

                    <!-- Past Events Section -->
                    {% if past_entries.count > 0 %}
                    <section class="col-xs-12" aria-labelledby="past-events-heading">
                        <h3 id="past-events-heading">Past events</h3>

                        <div class="events_list_container">
                            <div class="events-list" role="list" aria-label="Past events">
                                {% for entry in past_entries %}
                                {% set url = entry.url ? entry.url : '/events/' ~ entry.slug %}

                                <article class="row entry_item middle-xs" role="listitem">


                                    <div class="col-md-10 col-xs-12">
                                        <div class="row">
                                            <!-- Event Date -->
                                            <div class="col-md-2 col-xs-12 date_container">
                                                <time datetime="{{entry.start|date('c')}}"
                                                      aria-label="Event date">
                                                    <span class="date_day" aria-label="Date and month">{{entry.start|date("j M")}}</span>
                                                    <span class="date_year" aria-label="Year">{{entry.start|date("Y")}}</span>
                                                </time>
                                            </div>

                                            <!-- Event Content -->
                                            <div class="col-md-8 col-xs-12">
                                                {% if entry.cover_image %}
                                                <a href="{{'events'|page}}/{{entry.slug}}"
                                                   aria-describedby="event-image-{{entry.slug}}-desc">
                                                    <img src="{{entry.cover_image|crop_image|resize(174, auto, {'mode': 'crop'})}}"
                                                         alt="Cover image for {{entry.title}}"
                                                         role="img"
                                                         loading="lazy">
                                                </a>
                                                <span id="event-image-{{entry.slug}}-desc" class="sr-only">
                                        View details for {{entry.title}}
                                    </span>
                                                {% endif %}

                                                <h4 class="event-title">
                                                    <a href="{{'events'|page}}/{{entry.slug}}"
                                                       aria-describedby="event-title-{{entry.slug}}-desc">
                                                        {{entry.title|raw}}
                                                    </a>
                                                </h4>
                                                <span id="event-title-{{entry.slug}}-desc" class="sr-only">
                                        Event on {{entry.start|date("j M Y")}}
                                    </span>
                                            </div>

                                        </div>
                                    </div>



                                    <!-- Event Action -->
                                    <div class="col-md-2 col-xs-12 end-md center-xs">
                                        <a href="{{'events'|page}}/{{entry.slug}}"

                                           aria-describedby="learn-more-{{entry.slug}}-desc">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" viewBox="0 0 21 21" fill="none">
                                                <path d="M0.649968 10.2409L19.8315 10.2409M19.8315 10.2409L10.2407 19.8317M19.8315 10.2409L10.2407 0.650024" stroke="#00BDA7" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                        </a>
                                        <span id="learn-more-{{entry.slug}}-desc" class="sr-only">
                                        Learn more about {{entry.title}}
                                    </span>
                                    </div>
                                </article>
                                {% endfor %}
                            </div>
                        </div>

                        <!-- Pagination for Past Events -->
                        <nav class="pagination-container"
                             role="navigation"
                             aria-label="Past events pagination">
                            <div class="row container">
                                {{ past_entries.fragment('listView').render|raw }}
                            </div>
                        </nav>
                    </section>
                    {% endif %}
                </div>

                <!-- Calendar View Panel -->
                <div id="calendarView"
                     class="subtabContent"
                     role="tabpanel"
                     aria-labelledby="calendarView-tab"
                     aria-describedby="calendar-description">
                    <div id="calendar-description" class="sr-only">
                        Calendar view of events by date
                    </div>
                    {% component 'calendar' %}
                </div>
            </nav>
        </section>

        <!-- News about Events Tab Panel -->
        <section class="row news"
                 id="news-events"
                 role="tabpanel"
                 aria-labelledby="news-events-tab"
                 aria-describedby="news-events-description">
            <div id="news-events-description" class="sr-only">
                News articles related to events and activities
            </div>

            <div class="newslist-records">
                <h3 class="sr-only">Event-related News Articles</h3>
                {% partial 'components/newslist-records' records=events_articles %}
            </div>
        </section>
    </div>

    <!-- Events Bulletin -->
    <aside role="complementary" aria-labelledby="bulletin-heading">
        <h2 id="bulletin-heading" class="sr-only">Events Bulletin</h2>
        {% partial 'events-bulletin' %}
    </aside>
</main>

{% else %}

<main id="main-content" class="container" role="main" aria-labelledby="event-title">
    <div class="go-back-link"><a href="/events">Return to the events list</a></div>
    <article class="row single-news-item" role="article">
        <div class="col-md-8 col-xs-12">
            <header>
                <div class="news-title">
                    <h1 id="event-title" class="single-new-title">{{entry.title}}</h1>
                </div>
            </header>

            <!-- Event Image -->
            <div>
                {% if entry.cover_image %}
                <figure class="event-image-container">
                    <img class="content"
                         src="{{ entry.cover_image|crop_image|resize(673, auto, { mode: 'crop' }) }}"
                         alt="Featured image for {{entry.title}}"
                         role="img" />
                    <figcaption class="sr-only">
                        Main image for the event: {{entry.title}}
                    </figcaption>
                </figure>
                {% endif %}
            </div>

            <!-- Event Description -->
            <section aria-labelledby="event-description-heading">
                <h2 id="event-description-heading" class="sr-only">Event Description</h2>
                <div class="content event-description" role="document">
                    {{entry.description|raw}}
                </div>
            </section>
        </div>

        <!-- Right Sidebar -->
        <div class="col-md-4 col-xs-12">
            <aside class="event-sidebar" aria-label="Event information">

                <div class="event_info">
                    <!-- Date -->
                    <div class="event-sidebar__item">
                        <div class="event-sidebar__icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M5.83317 1.45825C6.17835 1.45825 6.45817 1.73807 6.45817 2.08325V2.71885C7.00986 2.70824 7.61767 2.70825 8.28616 2.70825H11.7135C12.382 2.70825 12.9898 2.70824 13.5415 2.71885V2.08325C13.5415 1.73807 13.8213 1.45825 14.1665 1.45825C14.5117 1.45825 14.7915 1.73807 14.7915 2.08325V2.77249C15.0081 2.78901 15.2133 2.80977 15.4074 2.83586C16.3844 2.96722 17.1752 3.24399 17.7988 3.86762C18.4224 4.49126 18.6992 5.28205 18.8306 6.25907C18.8725 6.57131 18.9007 6.91207 18.9196 7.28331C18.9445 7.3508 18.9582 7.42376 18.9582 7.49992C18.9582 7.55769 18.9503 7.61362 18.9357 7.66672C18.9582 8.33504 18.9582 9.09388 18.9582 9.95291V11.7136C18.9582 13.2451 18.9582 14.4581 18.8306 15.4074C18.6992 16.3845 18.4224 17.1752 17.7988 17.7989C17.1752 18.4225 16.3844 18.6993 15.4074 18.8306C14.458 18.9583 13.245 18.9583 11.7135 18.9583H8.28616C6.75469 18.9583 5.54166 18.9583 4.59232 18.8306C3.6153 18.6993 2.82451 18.4225 2.20087 17.7989C1.57724 17.1752 1.30047 16.3845 1.16912 15.4074C1.04148 14.4581 1.04149 13.2451 1.0415 11.7136V9.9529C1.0415 9.09388 1.04149 8.33504 1.06401 7.66673C1.04934 7.61362 1.0415 7.55769 1.0415 7.49992C1.0415 7.42377 1.05512 7.35079 1.08006 7.2833C1.09897 6.91207 1.12714 6.57131 1.16912 6.25907C1.30047 5.28205 1.57724 4.49126 2.20087 3.86762C2.82451 3.24398 3.6153 2.96722 4.59232 2.83586C4.78642 2.80977 4.99155 2.78901 5.20817 2.77249V2.08325C5.20817 1.73807 5.48799 1.45825 5.83317 1.45825ZM2.30241 8.12492C2.29177 8.66886 2.2915 9.28824 2.2915 9.99992V11.6666C2.2915 13.2556 2.29283 14.3845 2.40797 15.2409C2.52069 16.0793 2.73208 16.5623 3.08476 16.915C3.43743 17.2677 3.92047 17.4791 4.75888 17.5918C5.61526 17.7069 6.74415 17.7083 8.33317 17.7083H11.6665C13.2555 17.7083 14.3844 17.7069 15.2408 17.5918C16.0792 17.4791 16.5622 17.2677 16.9149 16.915C17.2676 16.5623 17.479 16.0793 17.5917 15.2409C17.7068 14.3845 17.7082 13.2556 17.7082 11.6666V9.99992C17.7082 9.28824 17.7079 8.66886 17.6973 8.12492H2.30241ZM17.6401 6.87492H2.35957C2.37292 6.71709 2.38888 6.56761 2.40797 6.42563C2.52069 5.58722 2.73208 5.10418 3.08476 4.7515C3.43743 4.39883 3.92047 4.18744 4.75888 4.07472C5.61527 3.95958 6.74415 3.95825 8.33317 3.95825H11.6665C13.2555 3.95825 14.3844 3.95958 15.2408 4.07472C16.0792 4.18744 16.5622 4.39883 16.9149 4.7515C17.2676 5.10418 17.479 5.58722 17.5917 6.42563C17.6108 6.56761 17.6268 6.71709 17.6401 6.87492Z" fill="white"/>
                            </svg>
                        </div>
                        <div class="event-sidebar__text">
                            <time datetime="{{entry.start|date('c')}}">
                                {% if entry.start|date("j") == entry.end|date("j") %}
                                {{entry.start|date("j M Y")}}
                                {% elseif entry.start|date("M") == entry.end|date("M") %}
                                {{entry.start|date("j")}}-{{entry.end|date("j M Y")}}
                                {% else %}
                                {{entry.start|date("d M Y")}} - {{entry.end|date("d M Y")}}
                                {% endif %}
                            </time>
                        </div>
                    </div>

                    <!-- Location -->
                    {% if entry.place %}
                    <div class="event-sidebar__item">
                        <div class="event-sidebar__icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="15" height="18" viewBox="0 0 15 18" fill="none">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M0 7.41108C0 3.32856 3.25418 0 7.29167 0C11.3292 0 14.5833 3.32856 14.5833 7.41108C14.5833 9.382 14.0216 11.4983 13.0287 13.3266C12.037 15.1526 10.588 16.7394 8.77543 17.5866C7.83381 18.0267 6.74953 18.0267 5.80791 17.5866C3.99531 16.7394 2.54635 15.1526 1.55463 13.3266C0.561691 11.4983 0 9.382 0 7.41108ZM7.29167 1.25C3.96536 1.25 1.25 3.9979 1.25 7.41108C1.25 9.15864 1.75219 11.0712 2.65309 12.73C3.5552 14.391 4.83002 15.7497 6.3372 16.4542C6.94338 16.7375 7.63996 16.7375 8.24613 16.4542C9.75332 15.7497 11.0281 14.391 11.9302 12.73C12.8311 11.0712 13.3333 9.15864 13.3333 7.41108C13.3333 3.9979 10.618 1.25 7.29167 1.25ZM7.29167 5.41667C6.25613 5.41667 5.41667 6.25613 5.41667 7.29167C5.41667 8.3272 6.25613 9.16667 7.29167 9.16667C8.3272 9.16667 9.16667 8.3272 9.16667 7.29167C9.16667 6.25613 8.3272 5.41667 7.29167 5.41667ZM4.16667 7.29167C4.16667 5.56578 5.56578 4.16667 7.29167 4.16667C9.01756 4.16667 10.4167 5.56578 10.4167 7.29167C10.4167 9.01756 9.01756 10.4167 7.29167 10.4167C5.56578 10.4167 4.16667 9.01756 4.16667 7.29167Z" fill="white"/>
                            </svg>
                        </div>
                        <div class="event-sidebar__text">
                            {{entry.place}}
                        </div>
                    </div>
                    {% endif %}

                    <!-- Website Link -->
                    {% if entry.url %}
                    <div class="event-sidebar__link">
                        <a href="{{entry.url}}"
                           target="_blank"
                           rel="noopener noreferrer">
                            Go to event website
                            <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 13 13" fill="none">
                                <path d="M0.649829 6.3068L11.9635 6.30676M11.9635 6.30676L6.30664 11.9636M11.9635 6.30676L6.30664 0.649902" stroke="#00BDA7" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <span class="sr-only">(opens in new window)</span>
                        </a>
                    </div>
                    {% endif %}
                </div>

                <div class="event_share">
                    <!-- Share -->
                    <div class="event-sidebar__share">
                        <h3 class="event-sidebar__share-title">Share this event</h3>
                        <div aria-label="Social media sharing options">
                            <ul class="event-sidebar__share-list">
                                <li role="listitem">
                                    <a href="https://bsky.app/intent/compose?text={{article.title}}20%{{page_url}}"
                                       target="_blank"
                                       rel="noopener noreferrer"
                                       class="pr p-bluesky big hexagon"
                                       aria-describedby="bluesky-share-desc">
                                        <span class="sr-only">Share on BlueSky</span>
                                        <span aria-hidden="true" class="social-icon"></span>
                                    </a>
                                    <span id="bluesky-share-desc" class="sr-only">
                                    Share {{entry.title}} on BlueSky (opens in new window)
                                </span>
                                </li>
                                <li role="listitem">
                                    <a href="https://www.linkedin.com/sharing/share-offsite/?url={{page_url}}"
                                       target="_blank"
                                       rel="noopener noreferrer"
                                       class="pr p-linkedin big hexagon"
                                       aria-describedby="linkedin-share-desc">
                                        <span class="sr-only">Share on LinkedIn</span>
                                        <span aria-hidden="true" class="social-icon"></span>
                                    </a>
                                    <span id="linkedin-share-desc" class="sr-only">
                                    Share {{entry.title}} on LinkedIn (opens in new window)
                                </span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

            </aside>
        </div>
    </article>
</main>


{% endif %}
